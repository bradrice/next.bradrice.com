{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport React, { useState, useEffect } from \"react\";\nimport { useRouter } from 'next/router';\nimport Link from 'next/link';\nimport { CardElement, useStripe, useElements } from \"@stripe/react-stripe-js\";\nimport { Form } from \"react-bootstrap\";\nexport default function CheckoutForm(props) {\n  const {\n    0: succeeded,\n    1: setSucceeded\n  } = useState(false);\n  const {\n    0: error,\n    1: setError\n  } = useState(null);\n  const {\n    0: processing,\n    1: setProcessing\n  } = useState(false);\n  const {\n    0: disabled,\n    1: setDisabled\n  } = useState(true);\n  const {\n    0: clientSecret,\n    1: setClientSecret\n  } = useState('');\n  const {\n    0: purchase,\n    1: setPurchaseItem\n  } = useState({});\n  const stripe = useStripe();\n  const elements = useElements();\n  const router = useRouter();\n  useEffect(() => {\n    console.log(props); // Create PaymentIntent as soon as the page loads\n\n    const purchase = {\n      price: props.price,\n      title: props.title,\n      id: props.id\n    };\n    setPurchaseItem(purchase); // console.log(\"On checkout form\", purchase);\n\n    window.fetch(`${process.env.NEXT_PUBLIC_REACT_APP_API_SERVER}/create-payment-intent`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(purchase)\n    }).then(res => {\n      return res.json();\n    }).then(data => {\n      setClientSecret(data.clientSecret);\n    });\n  }, [props]);\n  const cardStyle = {\n    style: {\n      base: {\n        color: \"#32325d\",\n        fontFamily: 'Arial, sans-serif',\n        fontSmoothing: \"antialiased\",\n        fontSize: \"16px\",\n        \"::placeholder\": {}\n      },\n      invalid: {\n        color: \"#fa755a\",\n        iconColor: \"#fa755a\"\n      }\n    }\n  };\n\n  const handleSelectChange = e => {\n    const sel = document.getElementById(\"statesel\");\n    const selectedState = sel.options[sel.selectedIndex].value;\n    console.log(\"select state: \", selectedState);\n  };\n\n  const handleChange = async event => {\n    // Listen for changes in the CardElement\n    // and display any errors as the customer types their card details\n    setDisabled(event.empty);\n    setError(event.error ? event.error.message : \"\");\n  };\n\n  const handleSuccess = () => {\n    window.fetch(`${process.env.NEXT_PUBLIC_REACT_APP_API_SERVER}/send-sms-success`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(purchase)\n    }).then(res => {\n      router.push(\"/checkout/success\");\n      return res.json();\n    });\n  };\n\n  const handleSubmit = async ev => {\n    ev.preventDefault();\n    setProcessing(true);\n    const line1el = document.getElementById(\"line1\");\n    const line1 = line1el.value;\n    const line2el = document.getElementById(\"line2\");\n    const line2 = line2el.value;\n    const cityel = document.getElementById(\"city\");\n    const city = cityel.value; // const sel: HTMLInputElement = (document.getElementById('id') as HTMLInputElement).select();\n\n    const sel = document.getElementById(\"statesel\"); // let selectedState: string = (document.getElementById('id') as HTMLInputElement).select();\n\n    const selectedState = sel.options[sel.selectedIndex].value;\n    const postal_codeEl = document.getElementById('postal_code');\n    const postal_code = postal_codeEl.value;\n    const nameEl = document.getElementById('fullname');\n    let name = nameEl.value;\n    const emailEl = document.getElementById('emailaddress');\n    let email_address = emailEl.value;\n    let price = props.price;\n    const payload = await stripe.confirmCardPayment(clientSecret, {\n      payment_method: {\n        card: elements.getElement(CardElement)\n      },\n      receipt_email: email_address,\n      shipping: {\n        name: name,\n        address: {\n          line1: line1,\n          line2: line2,\n          city: city,\n          state: selectedState,\n          postal_code: postal_code\n        }\n      }\n    });\n\n    if (payload.error) {\n      setError(`Payment failed ${payload.error.message}`);\n      setProcessing(false);\n    } else {\n      setError(null);\n      setProcessing(false);\n      setSucceeded(true);\n      handleSuccess();\n    }\n  };\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    children: [/*#__PURE__*/_jsx(\"div\", {\n      className: \"row justify-content-center\",\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"details col-md-8\",\n        children: [/*#__PURE__*/_jsx(\"h2\", {\n          children: \"You are purchasing\"\n        }), /*#__PURE__*/_jsxs(\"h3\", {\n          children: [\"Artwork: \", props.title]\n        }), /*#__PURE__*/_jsxs(\"h3\", {\n          children: [\"Cost: \", /*#__PURE__*/_jsx(\"span\", {\n            children: props.price_format\n          })]\n        })]\n      })\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: \"row justify-content-center\",\n      children: /*#__PURE__*/_jsx(\"div\", {\n        className: \"col-md-8 align-self-center\",\n        children: /*#__PURE__*/_jsxs(Form, {\n          id: \"payment-form\",\n          onSubmit: handleSubmit,\n          children: [/*#__PURE__*/_jsxs(\"fieldset\", {\n            children: [/*#__PURE__*/_jsx(\"legend\", {\n              children: \"Shipping information:\"\n            }), /*#__PURE__*/_jsxs(Form.Group, {\n              children: [/*#__PURE__*/_jsx(Form.Label, {\n                htmlFor: \"fullname\",\n                children: \"Full Name\"\n              }), /*#__PURE__*/_jsx(Form.Control, {\n                name: \"fullname\",\n                id: \"fullname\",\n                className: \"form-input\"\n              })]\n            }), /*#__PURE__*/_jsxs(Form.Group, {\n              children: [/*#__PURE__*/_jsx(Form.Label, {\n                htmlFor: \"line1\",\n                children: \"Address 1\"\n              }), /*#__PURE__*/_jsx(Form.Control, {\n                name: \"line1\",\n                id: \"line1\"\n              })]\n            }), /*#__PURE__*/_jsxs(Form.Group, {\n              children: [/*#__PURE__*/_jsx(Form.Label, {\n                htmlFor: \"line2\",\n                children: \"Address 2\"\n              }), /*#__PURE__*/_jsx(Form.Control, {\n                name: \"line2\",\n                id: \"line2\"\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"row\",\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                className: \"col-md-6\",\n                children: /*#__PURE__*/_jsxs(Form.Group, {\n                  children: [/*#__PURE__*/_jsx(Form.Label, {\n                    htmlFor: \"inputCity\",\n                    children: \"City\"\n                  }), /*#__PURE__*/_jsx(Form.Control, {\n                    name: \"city\",\n                    id: \"city\"\n                  })]\n                })\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"col-md-4\",\n                children: /*#__PURE__*/_jsxs(Form.Group, {\n                  children: [/*#__PURE__*/_jsx(Form.Label, {\n                    htmlFor: \"state\",\n                    children: \"State\"\n                  }), /*#__PURE__*/_jsxs(Form.Control, {\n                    as: \"select\",\n                    name: \"statesel\",\n                    id: \"statesel\",\n                    onChange: handleSelectChange,\n                    children: [/*#__PURE__*/_jsx(\"option\", {\n                      value: \"AL\",\n                      children: \"Alabama\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"AK\",\n                      children: \"Alaska\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"AZ\",\n                      children: \"Arizona\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"AR\",\n                      children: \"Arkansas\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"CA\",\n                      children: \"California\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"CO\",\n                      children: \"Colorado\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"CT\",\n                      children: \"Connecticut\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"DE\",\n                      children: \"Delaware\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"DC\",\n                      children: \"District Of Columbia\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"FL\",\n                      children: \"Florida\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"GA\",\n                      children: \"Georgia\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"HI\",\n                      children: \"Hawaii\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"ID\",\n                      children: \"Idaho\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"IL\",\n                      children: \"Illinois\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"IN\",\n                      children: \"Indiana\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"IA\",\n                      children: \"Iowa\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"KS\",\n                      children: \"Kansas\"\n                    }), \"e\", /*#__PURE__*/_jsx(\"option\", {\n                      value: \"KY\",\n                      children: \"Kentucky\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"LA\",\n                      children: \"Louisiana\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"ME\",\n                      children: \"Maine\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"MD\",\n                      children: \"Maryland\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"MA\",\n                      children: \"Massachusetts\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"MI\",\n                      children: \"Michigan\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"MN\",\n                      children: \"Minnesota\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"MS\",\n                      children: \"Mississippi\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"MO\",\n                      children: \"Missouri\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"MT\",\n                      children: \"Montana\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"NE\",\n                      children: \"Nebraska\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"NV\",\n                      children: \"Nevada\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"NH\",\n                      children: \"New Hampshire\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"NJ\",\n                      children: \"New Jersey\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"NM\",\n                      children: \"New Mexico\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"NY\",\n                      children: \"New York\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"NC\",\n                      children: \"North Carolina\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"ND\",\n                      children: \"North Dakota\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"OH\",\n                      children: \"Ohio\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"OK\",\n                      children: \"Oklahoma\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"OR\",\n                      children: \"Oregon\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"PA\",\n                      children: \"Pennsylvania\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"RI\",\n                      children: \"Rhode Island\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"SC\",\n                      children: \"South Carolina\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"SD\",\n                      children: \"South Dakota\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"TN\",\n                      children: \"Tennessee\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"TX\",\n                      children: \"Texas\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"UT\",\n                      children: \"Utah\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"VT\",\n                      children: \"Vermont\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"VA\",\n                      children: \"Virginia\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"WA\",\n                      children: \"Washington\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"WV\",\n                      children: \"West Virginia\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"WI\",\n                      children: \"Wisconsin\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"WY\",\n                      children: \"Wyoming\"\n                    })]\n                  })]\n                })\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"col-md-2\",\n                children: /*#__PURE__*/_jsxs(Form.Group, {\n                  children: [/*#__PURE__*/_jsx(Form.Label, {\n                    htmlFor: \"postal_code\",\n                    children: \"Zip\"\n                  }), /*#__PURE__*/_jsx(Form.Control, {\n                    name: \"postal_code\",\n                    id: \"postal_code\"\n                  })]\n                })\n              })]\n            })]\n          }), /*#__PURE__*/_jsxs(\"fieldset\", {\n            children: [/*#__PURE__*/_jsx(\"legend\", {\n              children: \"Billing\"\n            }), /*#__PURE__*/_jsxs(Form.Group, {\n              children: [/*#__PURE__*/_jsx(Form.Label, {\n                htmlFor: \"email\",\n                children: \"Email\"\n              }), /*#__PURE__*/_jsx(Form.Control, {\n                name: \"receipt_email\",\n                id: \"emailaddress\"\n              })]\n            }), /*#__PURE__*/_jsx(CardElement, {\n              id: \"card-element\",\n              options: cardStyle,\n              onChange: handleChange\n            }), /*#__PURE__*/_jsx(\"button\", {\n              id: \"submit-btn\",\n              className: \"btn btn-primary submitBtn\",\n              disabled: processing || disabled || succeeded,\n              children: /*#__PURE__*/_jsx(\"span\", {\n                id: \"button-text\",\n                children: processing ? /*#__PURE__*/_jsx(\"div\", {\n                  className: \"spinner\",\n                  id: \"spinner\"\n                }) : \"Pay\"\n              })\n            }), error && /*#__PURE__*/_jsx(\"div\", {\n              className: \"card-error\",\n              role: \"alert\",\n              children: error\n            }), /*#__PURE__*/_jsxs(\"p\", {\n              className: succeeded ? \"result-message\" : \"result-message hidden\",\n              children: [\"Payment succeeded, thank you for your order. Return to the \", /*#__PURE__*/_jsx(Link, {\n                href: \"/art\",\n                children: \"art page\"\n              }), \".\"]\n            })]\n          })]\n        })\n      })\n    })]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}