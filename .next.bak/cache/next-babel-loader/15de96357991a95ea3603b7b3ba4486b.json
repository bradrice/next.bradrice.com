{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport React, { useState, useEffect } from \"react\";\nimport { useRouter } from 'next/router';\nimport Link from 'next/link';\nimport { CardElement, useStripe, useElements } from \"@stripe/react-stripe-js\";\nimport { Form } from \"react-bootstrap\";\nexport default function CheckoutForm(props) {\n  var _useState = useState(false),\n      succeeded = _useState[0],\n      setSucceeded = _useState[1];\n\n  var _useState2 = useState(null),\n      error = _useState2[0],\n      setError = _useState2[1];\n\n  var _useState3 = useState(false),\n      processing = _useState3[0],\n      setProcessing = _useState3[1];\n\n  var _useState4 = useState(true),\n      disabled = _useState4[0],\n      setDisabled = _useState4[1];\n\n  var _useState5 = useState(''),\n      clientSecret = _useState5[0],\n      setClientSecret = _useState5[1];\n\n  var _useState6 = useState({}),\n      purchase = _useState6[0],\n      setPurchaseItem = _useState6[1];\n\n  var stripe = useStripe();\n  var elements = useElements();\n  var router = useRouter();\n  useEffect(function () {\n    console.log(props); // Create PaymentIntent as soon as the page loads\n\n    var purchase = {\n      price: props.price,\n      title: props.title,\n      id: props.id\n    };\n    setPurchaseItem(purchase); // console.log(\"On checkout form\", purchase);\n\n    window.fetch(\"\".concat(process.env.NEXT_PUBLIC_REACT_APP_API_SERVER, \"/create-payment-intent\"), {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(purchase)\n    }).then(function (res) {\n      return res.json();\n    }).then(function (data) {\n      setClientSecret(data.clientSecret);\n    });\n  }, [props]);\n  var cardStyle = {\n    style: {\n      base: {\n        color: \"#32325d\",\n        fontFamily: 'Arial, sans-serif',\n        fontSmoothing: \"antialiased\",\n        fontSize: \"16px\",\n        \"::placeholder\": {}\n      },\n      invalid: {\n        color: \"#fa755a\",\n        iconColor: \"#fa755a\"\n      }\n    }\n  };\n\n  var handleSelectChange = function handleSelectChange(e) {\n    var sel = document.getElementById(\"statesel\");\n    var selectedState = sel.options[sel.selectedIndex].value;\n    console.log(\"select state: \", selectedState);\n  };\n\n  var handleChange = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              // Listen for changes in the CardElement\n              // and display any errors as the customer types their card details\n              setDisabled(event.empty);\n              setError(event.error ? event.error.message : \"\");\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleChange(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var handleSuccess = function handleSuccess() {\n    window.fetch(\"\".concat(process.env.NEXT_PUBLIC_REACT_APP_API_SERVER, \"/send-sms-success\"), {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(purchase)\n    }).then(function (res) {\n      router.push(\"/checkout/success\");\n      return res.json();\n    });\n  };\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(ev) {\n      var line1el, line1, line2el, line2, cityel, city, sel, selectedState, postal_codeEl, postal_code, nameEl, name, emailEl, email_address, price, payload;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              ev.preventDefault();\n              setProcessing(true);\n              line1el = document.getElementById(\"line1\");\n              line1 = line1el.value;\n              line2el = document.getElementById(\"line2\");\n              line2 = line2el.value;\n              cityel = document.getElementById(\"city\");\n              city = cityel.value; // const sel: HTMLInputElement = (document.getElementById('id') as HTMLInputElement).select();\n\n              sel = document.getElementById(\"statesel\"); // let selectedState: string = (document.getElementById('id') as HTMLInputElement).select();\n\n              selectedState = sel.options[sel.selectedIndex].value;\n              postal_codeEl = document.getElementById('postal_code');\n              postal_code = postal_codeEl.value;\n              nameEl = document.getElementById('fullname');\n              name = nameEl.value;\n              emailEl = document.getElementById('emailaddress');\n              email_address = emailEl.value;\n              price = props.price;\n              _context2.next = 19;\n              return stripe.confirmCardPayment(clientSecret, {\n                payment_method: {\n                  card: elements.getElement(CardElement)\n                },\n                receipt_email: email_address,\n                shipping: {\n                  name: name,\n                  address: {\n                    line1: line1,\n                    line2: line2,\n                    city: city,\n                    state: selectedState,\n                    postal_code: postal_code\n                  }\n                }\n              });\n\n            case 19:\n              payload = _context2.sent;\n\n              if (payload.error) {\n                setError(\"Payment failed \".concat(payload.error.message));\n                setProcessing(false);\n              } else {\n                setError(null);\n                setProcessing(false);\n                setSucceeded(true);\n                handleSuccess();\n              }\n\n            case 21:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function handleSubmit(_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    children: [/*#__PURE__*/_jsx(\"div\", {\n      className: \"row justify-content-center\",\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"details col-md-8\",\n        children: [/*#__PURE__*/_jsx(\"h2\", {\n          children: \"You are purchasing\"\n        }), /*#__PURE__*/_jsxs(\"h3\", {\n          children: [\"Artwork: \", props.title]\n        }), /*#__PURE__*/_jsxs(\"h3\", {\n          children: [\"Cost: \", /*#__PURE__*/_jsx(\"span\", {\n            children: props.price_format\n          })]\n        })]\n      })\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: \"row justify-content-center\",\n      children: /*#__PURE__*/_jsx(\"div\", {\n        className: \"col-md-8 align-self-center\",\n        children: /*#__PURE__*/_jsxs(Form, {\n          id: \"payment-form\",\n          onSubmit: handleSubmit,\n          children: [/*#__PURE__*/_jsxs(\"fieldset\", {\n            children: [/*#__PURE__*/_jsx(\"legend\", {\n              children: \"Shipping information:\"\n            }), /*#__PURE__*/_jsxs(Form.Group, {\n              children: [/*#__PURE__*/_jsx(Form.Label, {\n                htmlFor: \"fullname\",\n                children: \"Full Name\"\n              }), /*#__PURE__*/_jsx(Form.Control, {\n                name: \"fullname\",\n                id: \"fullname\",\n                className: \"form-input\"\n              })]\n            }), /*#__PURE__*/_jsxs(Form.Group, {\n              children: [/*#__PURE__*/_jsx(Form.Label, {\n                htmlFor: \"line1\",\n                children: \"Address 1\"\n              }), /*#__PURE__*/_jsx(Form.Control, {\n                name: \"line1\",\n                id: \"line1\"\n              })]\n            }), /*#__PURE__*/_jsxs(Form.Group, {\n              children: [/*#__PURE__*/_jsx(Form.Label, {\n                htmlFor: \"line2\",\n                children: \"Address 2\"\n              }), /*#__PURE__*/_jsx(Form.Control, {\n                name: \"line2\",\n                id: \"line2\"\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"row\",\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                className: \"col-md-6\",\n                children: /*#__PURE__*/_jsxs(Form.Group, {\n                  children: [/*#__PURE__*/_jsx(Form.Label, {\n                    htmlFor: \"inputCity\",\n                    children: \"City\"\n                  }), /*#__PURE__*/_jsx(Form.Control, {\n                    name: \"city\",\n                    id: \"city\"\n                  })]\n                })\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"col-md-4\",\n                children: /*#__PURE__*/_jsxs(Form.Group, {\n                  children: [/*#__PURE__*/_jsx(Form.Label, {\n                    htmlFor: \"state\",\n                    children: \"State\"\n                  }), /*#__PURE__*/_jsxs(Form.Control, {\n                    as: \"select\",\n                    name: \"statesel\",\n                    id: \"statesel\",\n                    onChange: handleSelectChange,\n                    children: [/*#__PURE__*/_jsx(\"option\", {\n                      value: \"AL\",\n                      children: \"Alabama\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"AK\",\n                      children: \"Alaska\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"AZ\",\n                      children: \"Arizona\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"AR\",\n                      children: \"Arkansas\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"CA\",\n                      children: \"California\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"CO\",\n                      children: \"Colorado\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"CT\",\n                      children: \"Connecticut\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"DE\",\n                      children: \"Delaware\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"DC\",\n                      children: \"District Of Columbia\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"FL\",\n                      children: \"Florida\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"GA\",\n                      children: \"Georgia\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"HI\",\n                      children: \"Hawaii\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"ID\",\n                      children: \"Idaho\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"IL\",\n                      children: \"Illinois\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"IN\",\n                      children: \"Indiana\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"IA\",\n                      children: \"Iowa\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"KS\",\n                      children: \"Kansas\"\n                    }), \"e\", /*#__PURE__*/_jsx(\"option\", {\n                      value: \"KY\",\n                      children: \"Kentucky\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"LA\",\n                      children: \"Louisiana\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"ME\",\n                      children: \"Maine\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"MD\",\n                      children: \"Maryland\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"MA\",\n                      children: \"Massachusetts\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"MI\",\n                      children: \"Michigan\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"MN\",\n                      children: \"Minnesota\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"MS\",\n                      children: \"Mississippi\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"MO\",\n                      children: \"Missouri\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"MT\",\n                      children: \"Montana\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"NE\",\n                      children: \"Nebraska\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"NV\",\n                      children: \"Nevada\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"NH\",\n                      children: \"New Hampshire\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"NJ\",\n                      children: \"New Jersey\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"NM\",\n                      children: \"New Mexico\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"NY\",\n                      children: \"New York\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"NC\",\n                      children: \"North Carolina\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"ND\",\n                      children: \"North Dakota\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"OH\",\n                      children: \"Ohio\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"OK\",\n                      children: \"Oklahoma\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"OR\",\n                      children: \"Oregon\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"PA\",\n                      children: \"Pennsylvania\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"RI\",\n                      children: \"Rhode Island\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"SC\",\n                      children: \"South Carolina\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"SD\",\n                      children: \"South Dakota\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"TN\",\n                      children: \"Tennessee\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"TX\",\n                      children: \"Texas\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"UT\",\n                      children: \"Utah\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"VT\",\n                      children: \"Vermont\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"VA\",\n                      children: \"Virginia\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"WA\",\n                      children: \"Washington\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"WV\",\n                      children: \"West Virginia\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"WI\",\n                      children: \"Wisconsin\"\n                    }), /*#__PURE__*/_jsx(\"option\", {\n                      value: \"WY\",\n                      children: \"Wyoming\"\n                    })]\n                  })]\n                })\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"col-md-2\",\n                children: /*#__PURE__*/_jsxs(Form.Group, {\n                  children: [/*#__PURE__*/_jsx(Form.Label, {\n                    htmlFor: \"postal_code\",\n                    children: \"Zip\"\n                  }), /*#__PURE__*/_jsx(Form.Control, {\n                    name: \"postal_code\",\n                    id: \"postal_code\"\n                  })]\n                })\n              })]\n            })]\n          }), /*#__PURE__*/_jsxs(\"fieldset\", {\n            children: [/*#__PURE__*/_jsx(\"legend\", {\n              children: \"Billing\"\n            }), /*#__PURE__*/_jsxs(Form.Group, {\n              children: [/*#__PURE__*/_jsx(Form.Label, {\n                htmlFor: \"email\",\n                children: \"Email\"\n              }), /*#__PURE__*/_jsx(Form.Control, {\n                name: \"receipt_email\",\n                id: \"emailaddress\"\n              })]\n            }), /*#__PURE__*/_jsx(CardElement, {\n              id: \"card-element\",\n              options: cardStyle,\n              onChange: handleChange\n            }), /*#__PURE__*/_jsx(\"button\", {\n              id: \"submit-btn\",\n              className: \"btn btn-primary submitBtn\",\n              disabled: processing || disabled || succeeded,\n              children: /*#__PURE__*/_jsx(\"span\", {\n                id: \"button-text\",\n                children: processing ? /*#__PURE__*/_jsx(\"div\", {\n                  className: \"spinner\",\n                  id: \"spinner\"\n                }) : \"Pay\"\n              })\n            }), error && /*#__PURE__*/_jsx(\"div\", {\n              className: \"card-error\",\n              role: \"alert\",\n              children: error\n            }), /*#__PURE__*/_jsxs(\"p\", {\n              className: succeeded ? \"result-message\" : \"result-message hidden\",\n              children: [\"Payment succeeded, thank you for your order. Return to the \", /*#__PURE__*/_jsx(Link, {\n                href: \"/art\",\n                children: \"art page\"\n              }), \".\"]\n            })]\n          })]\n        })\n      })\n    })]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}